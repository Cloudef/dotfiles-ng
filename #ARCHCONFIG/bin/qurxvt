#!/bin/sh
# Urxvt quake console
#
# needs: urxvt, xdotool

# border width * 2
BORDER=6

# offset
X=0
Y=1

# width && height
WIDTH=1440
HEIGHT=300

# spawn
spawn() {
   curxvt -name qurxvt -geometry 1x1+$X+$Y
   wid="$(xdotool search --classname qurxvt | head -1)"
   xdotool windowfocus $wid
   xdotool windowsize $wid $((WIDTH-BORDER)) $HEIGHT
}

# toggle
toggle() {
   local visible="$(xdotool search --onlyvisible --classname qurxvt 2>/dev/null)"
   if [ ! "$visible" ]; then
      xdotool windowmap $wid
      xdotool windowfocus $wid
      xdotool windowraise $wid
   else
      xdotool windowunmap $wid
   fi
}

# main
main() {
   local wid="$(xdotool search --classname qurxvt 2>&1 | head -1)"
   [[ "$wid" == *BadWindow* ]] && exit
   [ ! "$wid" ] && spawn || toggle
}
main $@
