#!/bin/sh
# Urxvt quake console
#
# needs: urxvt, xdotool

# border width * 2
BORDER=4

# width && height
WIDTH=$((1680-BORDER))
HEIGHT=300

# offset
X=0
Y=0

# spawn
spawn() {
   curxvt -name qurxvt -geometry 1x1+0+0
   wid="$(xdotool search --classname qurxvt | head -1)"
   xdotool windowsize $wid $WIDTH $HEIGHT
   xdotool windowmove $wid $X $Y
   xdotool windowraise $wid
}

# toggle
toggle() {
   local visible="$(xdotool search --onlyvisible --classname qurxvt 2>/dev/null)"
   [[ ! -n "$visible" ]] && {
      xdotool windowsize $wid $WIDTH $HEIGHT
      xdotool windowmap $wid
      xdotool windowmove $wid $X $Y
      xdotool windowraise $wid
   } || {
      xdotool windowunmap $wid
   }
}

# main
main() {
   local wid="$(xdotool search --classname qurxvt 2>&1 | head -1)"
   [[ "$wid" == *BadWindow* ]] && exit
   [[ ! -n "$wid" ]] && { spawn; } || toggle
}
main $@
